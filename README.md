# MediaMTX Monitor

**MediaMTX Monitor** — модульная система для мониторинга, конвертации и просмотра RTMP/RTSP/HLS потоков, оптимизированная для работы с БПЛА (дронами) и любыми видеоустройствами.

---

## Возможности
- **Конвертация RTMP → RTSP/HLS** с помощью MediaMTX
- **Модульная архитектура** (управление, мониторинг, веб-интерфейс — отдельные модули)
- **Веб-интерфейс** для мониторинга и просмотра потоков в реальном времени
- **Автоматическое обнаружение новых потоков**
- **Работа с несколькими потоками одновременно**
- **Логи событий и ошибок**
- **Готово для расширения и интеграции**

---

## Структура проекта

```
prototype/
│
├── main.py                # Точка входа, запуск сервера и CLI
├── mediamtx_manager.py    # Класс MediaMTXManager (запуск/остановка MediaMTX)
├── stream_monitor.py      # Класс StreamMonitor и StreamInfo (мониторинг потоков)
├── web/                   # Веб-интерфейс (FastAPI роуты, шаблоны)
│   ├── __init__.py
│   ├── routes.py
│   └── templates.py
├── utils.py               # Вспомогательные функции (логирование и др.)
├── locales/               # (опционально) локализация
│   ├── ru.yml
│   └── en.yml
├── requirements.txt       # Зависимости Python
└── README.md
```

---

## Установка

1. **Установите Python 3.8+**
2. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```
3. **Скачайте [MediaMTX](https://github.com/bluenviron/mediamtx/releases) для вашей ОС**
   - Поместите `mediamtx.exe` (или бинарник для вашей ОС) в корень проекта
4. **Проверьте/создайте конфиг** `mediamtx.minimal.yml` (пример уже есть в проекте)

---

## Запуск

### 1. Запуск сервера и MediaMTX

```bash
python main.py --web
```

- Веб-интерфейс будет доступен по адресу: [http://localhost:8000](http://localhost:8000)
- Для доступа с других устройств в сети используйте: `http://<ваш_IP>:8000`

### 2. Запуск только MediaMTX и CLI

```bash
python main.py
```

- Выводит инструкции и логи в консоль

### 3. Просмотр активных потоков в CLI

```bash
python main.py --status
```

---

## Использование

### 1. Настройка RTMP-трансляции (например, в OBS Studio)
- **Сервер:** `rtmp://localhost:1935/live`
- **Ключ потока:** `mystream` (или любой другой)

### 2. Просмотр потока
- **RTSP:** `rtsp://localhost:8554/live/mystream` (VLC, ffplay и др.)
- **HLS (в браузере):** `http://localhost:8888/live/mystream/index.m3u8`
- **Веб-интерфейс:** [http://localhost:8000/view](http://localhost:8000/view)

### 3. Мониторинг
- Главная страница: список всех потоков, статус, количество зрителей, время работы, быстрый копипаст ссылок
- Страница просмотра: видеоплееры для всех активных HLS-потоков (работает через hls.js)

---

## Примеры

- **Несколько дронов:**
  - Каждый дрон стримит на свой ключ: `rtmp://<сервер>/live/drone1`, `drone2`, ...
  - Все потоки автоматически появляются в мониторинге и на странице просмотра

- **Просмотр с другого устройства:**
  - Откройте в браузере: `http://<ваш_IP>:8000/view`

---

## FAQ

**Q: Почему не видно видео в браузере?**
- Проверьте, что поток реально идёт (OBS/дрон стримит)
- HLS-плейлист (`index.m3u8`) появляется только при активном потоке
- Проверьте логи MediaMTX и консоль браузера

**Q: Как добавить поддержку новых протоколов/фич?**
- Добавьте новый модуль или роут в папку `web/` или отдельный Python-файл
- Вся архитектура готова для расширения

**Q: Как запустить на сервере/в Docker?**
- Проект не зависит от ОС, можно запускать в Docker (добавьте Dockerfile при необходимости)

---

## Зависимости

- Python 3.8+
- fastapi
- uvicorn
- requests
- pyyaml
- hls.js (CDN для веб-интерфейса)
- MediaMTX (отдельно, не Python-пакет)

---

## Лицензия

MIT (или ваша лицензия) 